# Ralph Progress Log
Started: Wed Jan 28 23:18:45 CET 2026

## Codebase Patterns
- Xcode project structure: Browseroo.xcodeproj/project.pbxproj contains build configuration, Browseroo/ contains source files
- SwiftUI app uses @main attribute on App struct with Scene body
- Info.plist with LSUIElement=true makes app a menu bar agent (no Dock icon)
- Deployment target set in project.pbxproj under MACOSX_DEPLOYMENT_TARGET
- xcodebuild requires Xcode.app to be installed (Command Line Tools not sufficient)
- MenuBarExtra(title, systemImage:) is used for the menu bar dropdown (macOS 13.0+)
- Adding new .swift files requires 4 edits to project.pbxproj: PBXBuildFile, PBXFileReference, PBXGroup children, and PBXSourcesBuildPhase files
- Use LSCopyAllHandlersForURLScheme/LSCopyDefaultHandlerForURLScheme for browser detection (CoreServices)
---

## 2026-01-28 - US-001
- What was implemented:
  - Created Xcode project named Browseroo with SwiftUI lifecycle
  - Set LSUIElement to true in Info.plist (no Dock icon)
  - Set minimum deployment target to macOS 13.0
  - Created app entitlements, asset catalogs, and basic SwiftUI app structure
- Files changed:
  - Browseroo.xcodeproj/project.pbxproj (new)
  - Browseroo/BrowserooApp.swift (new)
  - Browseroo/ContentView.swift (new)
  - Browseroo/Info.plist (new)
  - Browseroo/Browseroo.entitlements (new)
  - Browseroo/Assets.xcassets/* (new)
- **Learnings for future iterations:**
  - xcodebuild requires full Xcode.app installation, not just Command Line Tools
  - Use `swiftc -parse` to verify Swift syntax when xcodebuild unavailable
  - LSUIElement in Info.plist controls whether app appears in Dock
  - Deployment target is set in both Debug and Release configurations in project.pbxproj
---

## 2026-01-28 - US-002
- What was implemented:
  - Replaced WindowGroup with MenuBarExtra in BrowserooApp
  - App now displays a globe icon in the macOS menu bar
  - Clicking the icon opens a dropdown menu with placeholder text "Browseroo"
  - Combined with LSUIElement=true, app does not appear in Dock
- Files changed:
  - Browseroo/BrowserooApp.swift (modified)
- **Learnings for future iterations:**
  - MenuBarExtra is the SwiftUI way to create menu bar apps (available macOS 13.0+)
  - MenuBarExtra takes a title (for accessibility), systemImage (SF Symbol name), and content closure
  - ContentView.swift is no longer used for menu bar apps but can be kept for potential window scenes
---

## 2026-01-28 - US-003
- What was implemented:
  - Created Browser struct with bundleIdentifier, name, and icon properties
  - Created BrowserManager class with getInstalledBrowsers() method
  - Uses LSCopyAllHandlersForURLScheme to query HTTPS URL handlers
  - Filters using a whitelist of known browser bundle identifiers
  - Gets app name from CFBundleName/CFBundleDisplayName and icon from NSWorkspace
  - Returns sorted array of Browser objects
- Files changed:
  - Browseroo/Browser.swift (new)
  - Browseroo/BrowserManager.swift (new)
  - Browseroo.xcodeproj/project.pbxproj (modified - added new files)
- **Learnings for future iterations:**
  - LSCopyAllHandlersForURLScheme returns CFArray of bundle identifiers, needs cast to [String]
  - takeRetainedValue() transfers ownership from CF to Swift (avoids memory leaks)
  - NSWorkspace.shared.urlForApplication(withBundleIdentifier:) finds app location
  - NSWorkspace.shared.icon(forFile:) gets app icon as NSImage
  - Whitelist approach for browser filtering is more reliable than heuristics
  - New Swift files must be added to PBXBuildFile, PBXFileReference, PBXGroup, and PBXSourcesBuildPhase in project.pbxproj
---

## 2026-01-28 - US-004
- What was implemented:
  - Added getDefaultBrowser() method to BrowserManager class
  - Uses LSCopyDefaultHandlerForURLScheme with 'https' scheme to get default browser bundle ID
  - Returns a Browser object matching the default, or nil if it cannot be determined
  - Follows same pattern as getInstalledBrowsers() for fetching app name and icon
- Files changed:
  - Browseroo/BrowserManager.swift (modified)
- **Learnings for future iterations:**
  - LSCopyDefaultHandlerForURLScheme returns a single CFString (vs CFArray for LSCopyAllHandlersForURLScheme)
  - Cast pattern for default handler: LSCopyDefaultHandlerForURLScheme(...)?.takeRetainedValue() as String?
  - Default browser detection doesn't require whitelist filtering - it returns whatever the user has set
---

## 2026-01-28 - US-005
- What was implemented:
  - Created BrowserMenuView struct with @State properties for browsers list and default browser ID
  - Menu displays all installed browsers using ForEach over Browser array
  - Each browser shows icon (Image(nsImage:)) and name (Text)
  - Current default browser has a checkmark (Image(systemName: "checkmark"))
  - List refreshes when menu opens using .onAppear modifier
  - Button placeholder added for browser switching (to be implemented in US-006)
- Files changed:
  - Browseroo/BrowserooApp.swift (modified)
- **Learnings for future iterations:**
  - SwiftUI MenuBarExtra content uses standard SwiftUI views (Button, HStack, ForEach, etc.)
  - Image(nsImage:) is used to display NSImage in SwiftUI
  - Group wrapper needed around ForEach to attach .onAppear modifier
  - .onAppear is called each time the menu opens, ensuring fresh browser list
---
